$utf8 = New-Object System.Text.UTF8Encoding $false
$latin1 = [System.Text.Encoding]::GetEncoding("ISO-8859-1")

$replacements = @(
    # [Old Bytes (Misinterpreted Latin1)], [New Bytes (Correct UTF-8 Emoji)]
    @{ Match = @(0xf0, 0x9f, 0x93, 0x9a); Replace = @(0xf0, 0x9f, 0x93, 0x9a) }, # ğŸ“š
    @{ Match = @(0xf0, 0x9f, 0x93, 0x96); Replace = @(0xf0, 0x9f, 0x93, 0x96) }, # ğŸ“–
    @{ Match = @(0xf0, 0x9f, 0x93, 0xb0); Replace = @(0xf0, 0x9f, 0x93, 0xb0) }, # ğŸ“°
    @{ Match = @(0xf0, 0x9f, 0x92, 0xbb); Replace = @(0xf0, 0x9f, 0x92, 0xbb) }, # ğŸ’»
    @{ Match = @(0xf0, 0x9f, 0x94, 0x8d); Replace = @(0xf0, 0x9f, 0x94, 0x8d) }, # ğŸ”
    @{ Match = @(0xf0, 0x9f, 0x93, 0x8d); Replace = @(0xf0, 0x9f, 0x93, 0x8d) }, # ğŸ“
    @{ Match = @(0xf0, 0x9f, 0x96, 0xa8, 0xef, 0xb8, 0x8f); Replace = @(0xf0, 0x9f, 0x96, 0xa8, 0xef, 0xb8, 0x8f) }, # ğŸ–¨ï¸
    @{ Match = @(0xf0, 0x9f, 0x93, 0x9e); Replace = @(0xf0, 0x9f, 0x93, 0x9e) }, # ğŸ“
    @{ Match = @(0xe2, 0x9c, 0x89, 0xef, 0xb8, 0x8f); Replace = @(0xe2, 0x9c, 0x89, 0xef, 0xb8, 0x8f) }, # âœ‰ï¸
    @{ Match = @(0xf0, 0x9f, 0x92, 0xac); Replace = @(0xf0, 0x9f, 0x92, 0xac) }, # ğŸ’¬
    @{ Match = @(0xf0, 0x9f, 0x92, 0xb0); Replace = @(0xf0, 0x9f, 0x92, 0xb0) }, # ğŸ’°
    @{ Match = @(0xf0, 0x9f, 0x8f, 0x97, 0xef, 0xb8, 0x8f); Replace = @(0xf0, 0x9f, 0x8f, 0x97, 0xef, 0xb8, 0x8f) }, # ğŸ—ï¸
    @{ Match = @(0xf0, 0x9f, 0x8d, 0xbd, 0xef, 0xb8, 0x8f); Replace = @(0xf0, 0x9f, 0x8d, 0xbd, 0xef, 0xb8, 0x8f) }, # ğŸ½ï¸
    @{ Match = @(0xf0, 0x9f, 0x94, 0xac); Replace = @(0xf0, 0x9f, 0x94, 0xac) }, # ğŸ”¬
    @{ Match = @(0xf0, 0x9f, 0x8e, 0xa8); Replace = @(0xf0, 0x9f, 0x8e, 0xa8) }, # ğŸ¨
    @{ Match = @(0xf0, 0x9f, 0x8e, 0xad); Replace = @(0xf0, 0x9f, 0x8e, 0xad) }, # ğŸ­
    @{ Match = @(0xf0, 0x9f, 0x8e, 0x93); Replace = @(0xf0, 0x9f, 0x8e, 0x93) }, # ğŸ“
    @{ Match = @(0xf0, 0x9f, 0x93, 0x88); Replace = @(0xf0, 0x9f, 0x93, 0x88) }, # ğŸ“ˆ
    @{ Match = @(0xf0, 0x9f, 0x92, 0xbc); Replace = @(0xf0, 0x9f, 0x92, 0xbc) }, # ğŸ’¼
    @{ Match = @(0xf0, 0x9f, 0x8f, 0xab); Replace = @(0xf0, 0x9f, 0x8f, 0xab) }, # ğŸ«
    @{ Match = @(0xf0, 0x9f, 0x93, 0x93); Replace = @(0xf0, 0x9f, 0x93, 0x93) }  # ğŸ““
)

$files = Get-ChildItem -Filter *.html
foreach ($file in $files) {
    Write-Host "Repairing icons in $($file.Name)..."
    $bytes = [System.IO.File]::ReadAllBytes($file.FullName)
    $content = $latin1.GetString($bytes)
    
    foreach ($r in $replacements) {
        $search = $latin1.GetString($r.Match)
        $repl = $utf8.GetString($r.Replace)
        $content = $content.Replace($search, $repl)
    }
    
    [System.IO.File]::WriteAllText($file.FullName, $content, $utf8)
}
Write-Host "Site-wide icon fix complete."
